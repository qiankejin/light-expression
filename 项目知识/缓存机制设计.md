---
title: 缓存机制设计
type: note
permalink: architecture/缓存机制设计
---

# 缓存机制设计

## ExpressionCache 类
实现了表达式缓存功能，使用Caffeine框架实现本地缓存。

### 缓存特性
- 缓存大小限制：最多1000个条目
- 访问后过期时间：1小时
- 权重计算：基于表达式长度

### 缓存键值设计
- 键：表达式字符串
- 值：编译后的Var对象

### 缓存操作
- `get(String expression)` - 获取缓存的表达式
- `put(String expression, Var var)` - 放入缓存
- `clear()` - 清空缓存
- `stats()` - 获取缓存统计信息

### 使用场景
- 频繁使用的表达式避免重复编译
- 提升表达式执行性能
- 控制内存使用量

## FastMap 类
高性能映射表，用于字符类型快速识别。

### 特性
- 固定大小数组（256个元素）
- 直接通过字符ASCII码访问
- 避免哈希计算开销
- 适用于有限字符集映射

### 应用场景
- 词法分析中的字符类型识别
- 运算符字符快速匹配
- 提升解析性能