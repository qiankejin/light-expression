---
title: 表达式解析流程
type: note
permalink: architecture/表达式解析流程
---

# 表达式解析流程

## 解析步骤
1. **词法分析** - 通过LexicalRunner将表达式字符串分解为词法单元
2. **语法分析** - 通过GrammarRunner将词法单元组装成语法树
3. **执行计算** - 通过语法树执行表达式计算

## 关键组件
- `LexicalRunner` - 词法分析器
- `GrammarRunner` - 语法分析器
- `ExpressCompiler` - 表达式编译入口
- `Node` - 语法树节点基类
- `Operators` - 操作符基类
- `Var` - 变量基类
- `Value` - 值基类

## 词法类型
- `ARG` - 变量
- `NUMBER` - 数字
- `TEXT` - 文本
- `OPERATOR` - 操作符
- `METHOD` - 方法

## 语法状态
- `START` - 开始状态
- `ARG_REDUCTION` - 变量规约
- `NUMBER_REDUCTION` - 数字规约
- `OPERATOR_REDUCTION` - 操作符规约
- `TEXT_REDUCTION` - 文本规约
- `BROKER_REDUCTION` - 分隔符规约
- `SINGLE_REDUCE` - 单目运算符规约
- `OPERATOR_REDUCE` - 操作符规约
- `ARG_LIST_REDUCE` - 参数列表规约
- `BROKER_REDUCE` - 分隔符规约

## 操作符优先级
- `LEVEL_1` (10) - 逗号
- `LEVEL_2` (20) - 赋值运算符
- `LEVEL_3` (30) - 逻辑或
- `LEVEL_4` (40) - 逻辑与
- `LEVEL_5` (50) - 按位或
- `LEVEL_6` (60) - 按位异或
- `LEVEL_7` (70) - 按位与
- `LEVEL_8` (80) - 比较运算符
- `LEVEL_9` (90) - 加减运算符
- `LEVEL_10` (100) - 乘除运算符
- `LEVEL_11` (110) - 取负、按位取反
- `LEVEL_12` (120) - 方法调用
- `LEVEL_13` (130) - 括号