---
title: 操作符优先级详解
type: note
permalink: reference/操作符优先级详解
---

# 操作符优先级详解

在light-expression表达式引擎中，操作符具有不同的优先级，这决定了表达式中操作的执行顺序。了解操作符优先级对于编写正确的表达式至关重要。

## 优先级列表（从高到低）

### 1. 括号 (LEVEL_13)
- 符号: `( )`
- 优先级: 130
- 用途: 改变操作的执行顺序
- 示例: `(2 + 3) * 4` → 20，而非 `2 + 3 * 4` → 14

### 2. 方法调用 (LEVEL_12)
- 符号: 函数名()
- 优先级: 120
- 用途: 函数调用
- 示例: `MAX(1, 2, 3)` → 3

### 3. 单目运算符 (LEVEL_11)
- 符号: `-` (取负), `~` (按位取反), `!` (逻辑非)
- 优先级: 110
- 用途: 对单个操作数进行运算
- 示例: `-5` → -5, `!true` → false

### 4. 乘除模运算符 (LEVEL_10)
- 符号: `*` (乘), `/` (除), `%` (取模)
- 优先级: 100
- 用途: 乘法、除法、取模运算
- 示例: `6 * 2 / 3` → 4, `10 % 3` → 1

### 5. 加减运算符 (LEVEL_9)
- 符号: `+` (加), `-` (减)
- 优先级: 90
- 用途: 加法、减法运算
- 示例: `5 + 3 - 2` → 6

### 6. 比较运算符 (LEVEL_8)
- 符号: `=` (等于), `<>` (不等于), `<` (小于), `>` (大于), `<=` (小于等于), `>=` (大于等于)
- 优先级: 80
- 用途: 比较两个值
- 示例: `5 > 3` → true, `5 = 5` → true

### 7. 按位与 (LEVEL_7)
- 符号: `&` (按位与)
- 优先级: 70
- 用途: 按位与运算
- 示例: `5 & 3` → 1

### 8. 按位异或 (LEVEL_6)
- 符号: `^` (按位异或，注意：不是幂运算)
- 优先级: 60
- 用途: 按位异或运算
- 示例: `5 ^ 3` → 6

### 9. 按位或 (LEVEL_5)
- 符号: `|` (按位或)
- 优先级: 50
- 用途: 按位或运算
- 示例: `5 | 3` → 7

### 10. 逻辑与 (LEVEL_4)
- 符号: `&&` (逻辑与)
- 优先级: 40
- 用途: 逻辑与运算
- 示例: `true && false` → false

### 11. 逻辑或 (LEVEL_3)
- 符号: `||` (逻辑或)
- 优先级: 30
- 用途: 逻辑或运算
- 示例: `true || false` → true

### 12. 赋值运算符 (LEVEL_2)
- 符号: `:=` (赋值)
- 优先级: 20
- 用途: 变量赋值
- 注意: 当前版本可能不支持

### 13. 逗号运算符 (LEVEL_1)
- 符号: `,` (逗号)
- 优先级: 10
- 用途: 分隔函数参数
- 示例: `MAX(1, 2, 3)` 中的逗号

## 幂运算符的特殊情况

注意：在light-expression中，幂运算使用 `^` 符号，但它实际上属于单目运算符层级，这意味着它的优先级高于加减运算但低于乘除运算。

## 运算顺序规则

1. **相同优先级**：从左到右依次计算
   - 示例: `10 - 5 - 2` → `(10 - 5) - 2` → 3，而不是 `10 - (5 - 2)` → 7

2. **不同优先级**：先计算高优先级的操作
   - 示例: `2 + 3 * 4` → `2 + (3 * 4)` → 14，而不是 `(2 + 3) * 4` → 20

3. **括号覆盖**：括号内的表达式总是优先计算
   - 示例: `(2 + 3) * 4` → `5 * 4` → 20

## 常见陷阱

1. **混淆幂运算和按位异或**：
   - 在某些语言中 `^` 表示幂运算，在light-expression中 `^` 表示按位异或
   - 幂运算在light-expression中也是用 `^`，需要特别注意

2. **比较运算符链式使用**：
   - `3 < 5 < 10` 在数学中为真，但在编程语言中通常先计算 `3 < 5` 得到 true，然后计算 `true < 10`，这通常是错误的
   - 正确写法应该是: `(3 < 5) && (5 < 10)`

3. **逻辑运算符与比较运算符**：
   - `5 > 3 && 2 < 4` → `true && true` → true
   - 注意比较运算符优先级高于逻辑运算符

## 建议

为了提高表达式的可读性和避免歧义，建议：
1. 使用括号明确指定运算顺序
2. 复杂表达式拆分为多个简单表达式
3. 在不确定优先级时，显式使用括号